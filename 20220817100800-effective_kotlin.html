<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-08-30 Tue 16:57 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Effective Kotlin</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="static/x.css" type="text/css"/><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<div id="content" class="content">
<h1 class="title">Effective Kotlin</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgf8a6e99">1. Introduction: Be pragmatic</a>
<ul>
<li><a href="#orgd09281a">1.1. The philosophy of Kotlin</a></li>
<li><a href="#orga4385a5">1.2. The purpose of this book</a></li>
<li><a href="#org0ce62db">1.3. For whom is this book written?</a></li>
<li><a href="#org357d5e2">1.4. Book design</a></li>
<li><a href="#org0118f81">1.5. Chapters organization</a></li>
<li><a href="#orgb8f3838">1.6. How should this book be read?</a></li>
<li><a href="#orgd587132">1.7. Labels</a></li>
<li><a href="#org0cc1432">1.8. Suggestions</a></li>
</ul>
</li>
<li><a href="#org33b5d4d">2. Part 1: Good code</a>
<ul>
<li><a href="#org51de55e">2.1. Chapter 1: Safety</a>
<ul>
<li><a href="#org5d68926">2.1.1. Item 1: Limit mutability</a></li>
<li><a href="#org5b4a780">2.1.2. Item 2: Minimize the scope of variables</a></li>
<li><a href="#org11389d4">2.1.3. Item 3: Eliminate platform types as soon as possible</a></li>
<li><a href="#orgbc715b9">2.1.4. Item 4: Do not expose inferred types</a></li>
<li><a href="#org6e036b4">2.1.5. Item 5: Specify your expectations on arguments and state</a></li>
</ul>
</li>
<li><a href="#org43c3bce">2.2. Chatper 2: Readability</a>
<ul>
<li><a href="#org9d72a47">2.2.1. Item 11: Design for readability</a>
<ul>
<li><a href="#org101616a">2.2.1.1. Reducing cognitive load</a></li>
<li><a href="#orgc798def">2.2.1.2. Do not get extreme</a></li>
<li><a href="#org1847ddb">2.2.1.3. Conventions</a></li>
</ul>
</li>
<li><a href="#orga5123b5">2.2.2. Item 12: Operator meaning should be consistent with its function name</a></li>
<li><a href="#orgeab3612">2.2.3. Item 16: Properties should represent state, not behavior</a></li>
<li><a href="#orgc21d7f3">2.2.4. Item 17: Consider naming arguments</a></li>
<li><a href="#org06a2e87">2.2.5. Item 18: Respect coding conventions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orga0dfea7">3. Part 2: Code design</a>
<ul>
<li><a href="#org0931240">3.1. Chapter 3: Reusability</a>
<ul>
<li><a href="#org472a4f6">3.1.1. Item 19: Do not repeat knowledge</a></li>
<li><a href="#org89394c4">3.1.2. Item 20: Do not repeat common algorithms</a></li>
<li><a href="#org9dcabf4">3.1.3. Item 21: Use Property delegation to extract common property patterns</a></li>
<li><a href="#org1c67830">3.1.4. Item 23: Avoid shadowing type parameters</a></li>
<li><a href="#org4d5c895">3.1.5. Item 25: Reuse between different platforms by extracting common modules</a></li>
</ul>
</li>
<li><a href="#org04cd317">3.2. Chapter 4: Abstraction design</a>
<ul>
<li><a href="#org68ddbe7">3.2.1. Item 26: Each function should be written in terms of a single level of abstraction</a></li>
<li><a href="#orgdf8290a">3.2.2. Item 27: Use abstraction to protect code against changes</a>
<ul>
<li><a href="#orgd295203">3.2.2.1. Abstractions give freedom</a></li>
<li><a href="#org491f67e">3.2.2.2. Problems with abstraction</a></li>
</ul>
</li>
<li><a href="#orgf499d12">3.2.3. Item 28: Specify API stability</a></li>
<li><a href="#org82207ef">3.2.4. Item 29: Consider wrapping external API</a></li>
<li><a href="#orga14884b">3.2.5. Item 30: Minimize elements visibility</a></li>
<li><a href="#org8ff2c1b">3.2.6. Item 31: Define contract with documentation</a></li>
</ul>
</li>
<li><a href="#org238da32">3.3. Chapter 5: Object creation</a></li>
<li><a href="#orgf547a7f">3.4. Chapter 6: Class design</a>
<ul>
<li><a href="#org12270f5">3.4.1. Item 36: Prefer composition over inheritance</a></li>
<li><a href="#orgf20c906">3.4.2. Item 37: Use the data modifier to represent a bundle of data</a></li>
<li><a href="#org53c2924">3.4.3. Item 38: Use function types instead of interfaces to pass operations and actions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<dl class="org-dl">
<dt>link</dt><dd><a href="20210505063407-kotlin.html#ID-5F0F4BA6-E79A-4214-9DD7-CD79DC775854">Kotlin</a></dd>
<dt>start</dt><dd><span class="timestamp-wrapper"><span class="timestamp">&lt;2022-08-17 Wed 10:09&gt;</span></span></dd>
</dl>

<div id="outline-container-orgf8a6e99" class="outline-2">
<h2 id="orgf8a6e99"><span class="section-number-2">1.</span> Introduction: Be pragmatic</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgd09281a" class="outline-3">
<h3 id="orgd09281a"><span class="section-number-3">1.1.</span> The philosophy of Kotlin</h3>
<div class="outline-text-3" id="text-1-1">
<p>
The central point of Kotlin's philosophy is pragmatism. This means that in the end, all choices need to serve business needs, like:
</p>
<ul class="org-ul">
<li><i>Productivity</i>: application production is fast.</li>
<li><i>Scalability</i>: with application growth, its development does not become more expensive. It may even get cheaper.</li>
<li><i>Maintainability</i>: maintenance is easy.</li>
<li><i>Reliability</i>: applications behave as expected, and there are fewer errors.</li>
<li><i>Efficiency</i>: the application runs fast and needs fewer resources (memory, processor, etc.).</li>
</ul>
</div>
</div>
<div id="outline-container-orga4385a5" class="outline-3">
<h3 id="orga4385a5"><span class="section-number-3">1.2.</span> The purpose of this book</h3>
<div class="outline-text-3" id="text-1-2">
<p>
The main goal of this book is to explain how to use different Kotlin features to achieve safe, readable, scalable, and efficient code.
</p>

<p>
This book concentrates on higher-level good practices that come from authorities, the Kotlin creators, and from my experience as a developer, consultant, and trainer for international companies worldwide.
</p>
</div>
</div>
<div id="outline-container-org0ce62db" class="outline-3">
<h3 id="org0ce62db"><span class="section-number-3">1.3.</span> For whom is this book written?</h3>
<div class="outline-text-3" id="text-1-3">
<p>
I will assume that even experienced developers might not know some features. This is why I explain some concepts like:
</p>
<ul class="org-ul">
<li>Property</li>
<li>Platform type</li>
<li>Named arguments</li>
<li>Property delegation</li>
<li>DSL creation</li>
<li>Inline classes and functions</li>
</ul>
</div>
</div>
<div id="outline-container-org357d5e2" class="outline-3">
<h3 id="org357d5e2"><span class="section-number-3">1.4.</span> Book design</h3>
</div>
<div id="outline-container-org0118f81" class="outline-3">
<h3 id="org0118f81"><span class="section-number-3">1.5.</span> Chapters organization</h3>
</div>
<div id="outline-container-orgb8f3838" class="outline-3">
<h3 id="orgb8f3838"><span class="section-number-3">1.6.</span> How should this book be read?</h3>
</div>
<div id="outline-container-orgd587132" class="outline-3">
<h3 id="orgd587132"><span class="section-number-3">1.7.</span> Labels</h3>
<div class="outline-text-3" id="text-1-7">
<ul class="org-ul">
<li>Not Kotlin-specific</li>
<li>Basics</li>
<li>Edu</li>
</ul>
</div>
</div>
<div id="outline-container-org0cc1432" class="outline-3">
<h3 id="org0cc1432"><span class="section-number-3">1.8.</span> Suggestions</h3>
</div>
</div>
<div id="outline-container-org33b5d4d" class="outline-2">
<h2 id="org33b5d4d"><span class="section-number-2">2.</span> Part 1: Good code</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org51de55e" class="outline-3">
<h3 id="org51de55e"><span class="section-number-3">2.1.</span> Chapter 1: Safety</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-org5d68926" class="outline-4">
<h4 id="org5d68926"><span class="section-number-4">2.1.1.</span> Item 1: Limit mutability</h4>
</div>
<div id="outline-container-org5b4a780" class="outline-4">
<h4 id="org5b4a780"><span class="section-number-4">2.1.2.</span> Item 2: Minimize the scope of variables</h4>
</div>
<div id="outline-container-org11389d4" class="outline-4">
<h4 id="org11389d4"><span class="section-number-4">2.1.3.</span> Item 3: Eliminate platform types as soon as possible</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
<i>Platform type</i> - a type that comes from another language and has unknown nullability.
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="font-weight: bold;">public</span> <span style="font-weight: bold;">class</span> <span style="font-weight: bold; text-decoration: underline;">UserRepo</span> {
  <span style="font-weight: bold;">public</span> <span style="font-weight: bold; text-decoration: underline;">User</span> <span style="font-weight: bold;">getUser</span>() {
    <span style="font-weight: bold; font-style: italic;">//</span><span style="font-weight: bold; font-style: italic;">...</span>
  }
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kotlin">val repo = UserRepo()
val user1 = repo.user        // Type of user1 is User!
val user2: User = repo.user  // Type of user2 is User
val user3: User? = repo.user // Type of user3 is User?
</pre>
</div>

<p>
What're the differences between <code>User!</code> and <code>User</code>?
</p>
</div>
</div>
<div id="outline-container-orgbc715b9" class="outline-4">
<h4 id="orgbc715b9"><span class="section-number-4">2.1.4.</span> Item 4: Do not expose inferred types</h4>
<div class="outline-text-4" id="text-2-1-4">
<p>
If we are not sure about the type, we should specify it. In an external API, we should always specify types. We cannot let them be changed by accident. Inferred types can be too restrictive or can too easily change when our project envolves.
</p>
</div>
</div>
<div id="outline-container-org6e036b4" class="outline-4">
<h4 id="org6e036b4"><span class="section-number-4">2.1.5.</span> Item 5: Specify your expectations on arguments and state</h4>
<div class="outline-text-4" id="text-2-1-5">
<ul class="org-ul">
<li><i>require</i> block: a universal way to specify expectations on arguments.</li>
<li><i>check</i> block: a universal way to specify expectations on the state.</li>
<li><i>assert</i> block: a universal way to check if something is true in testing mode for our own implementation.</li>
<li>Elvis operator(<code>?:</code>) with <code>return</code> or <code>throw</code>.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org43c3bce" class="outline-3">
<h3 id="org43c3bce"><span class="section-number-3">2.2.</span> Chatper 2: Readability</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-org9d72a47" class="outline-4">
<h4 id="org9d72a47"><span class="section-number-4">2.2.1.</span> Item 11: Design for readability</h4>
<div class="outline-text-4" id="text-2-2-1">
</div>
<div id="outline-container-org101616a" class="outline-5">
<h5 id="org101616a"><span class="section-number-5">2.2.1.1.</span> Reducing cognitive load</h5>
</div>
<div id="outline-container-orgc798def" class="outline-5">
<h5 id="orgc798def"><span class="section-number-5">2.2.1.2.</span> Do not get extreme</h5>
</div>
<div id="outline-container-org1847ddb" class="outline-5">
<h5 id="org1847ddb"><span class="section-number-5">2.2.1.3.</span> Conventions</h5>
</div>
</div>
<div id="outline-container-orga5123b5" class="outline-4">
<h4 id="orga5123b5"><span class="section-number-4">2.2.2.</span> Item 12: Operator meaning should be consistent with its function name</h4>
</div>
<div id="outline-container-orgeab3612" class="outline-4">
<h4 id="orgeab3612"><span class="section-number-4">2.2.3.</span> Item 16: Properties should represent state, not behavior</h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
Properties are essentially functions, we can make extension properties as well:
</p>
<div class="org-src-container">
<pre class="src src-kotlin">val Context.preferences: SharedPreferences
  get() = PreferencesManager
    .getDefaultSharedPreferences(this)
</pre>
</div>

<p>
<b>Properties represent accessors, not fields.</b> The general rule is that <b>we should use them only to represent or set state, and no other logic should be involved.</b> If I would define a property as a function, would I prefix it with get/set? If not, it should rather not be a property.
</p>

<p>
The most typical situations when we should not use properties, and we should use functions instead:
</p>
<ul class="org-ul">
<li><b>Operation is computationally expensive or has computational complexity higher than O(1)</b></li>
<li><b>It involves business logic</b></li>
<li><b>It is not deterministic</b>: Calling the member twice in succession produces different results.</li>
<li><b>It is a conversion, such as</b> <code>Int.toDouble()</code></li>
<li><b>Getters should not change property state</b></li>
</ul>
</div>
</div>
<div id="outline-container-orgc21d7f3" class="outline-4">
<h4 id="orgc21d7f3"><span class="section-number-4">2.2.4.</span> Item 17: Consider naming arguments</h4>
</div>
<div id="outline-container-org06a2e87" class="outline-4">
<h4 id="org06a2e87"><span class="section-number-4">2.2.5.</span> Item 18: Respect coding conventions</h4>
</div>
</div>
</div>
<div id="outline-container-orga0dfea7" class="outline-2">
<h2 id="orga0dfea7"><span class="section-number-2">3.</span> Part 2: Code design</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org0931240" class="outline-3">
<h3 id="org0931240"><span class="section-number-3">3.1.</span> Chapter 3: Reusability</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-org472a4f6" class="outline-4">
<h4 id="org472a4f6"><span class="section-number-4">3.1.1.</span> Item 19: Do not repeat knowledge</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
The biggest enemy of changes is knowledge repetition.
</p>

<p>
Are they more likely going to change together or separately?
</p>
</div>
</div>
<div id="outline-container-org89394c4" class="outline-4">
<h4 id="org89394c4"><span class="section-number-4">3.1.2.</span> Item 20: Do not repeat common algorithms</h4>
</div>
<div id="outline-container-org9dcabf4" class="outline-4">
<h4 id="org9dcabf4"><span class="section-number-4">3.1.3.</span> Item 21: Use Property delegation to extract common property patterns</h4>
<div class="outline-text-4" id="text-3-1-3">
<div class="org-src-container">
<pre class="src src-kotlin">var token: String? by LoggingProperty(null)
var attempts: Int by LoggingProperty(0)

private class LoggingProperty&lt;T&gt;(var value: T) {
  operator fun getValue(
    thisRef: Any?,
    prop: KProperty&lt;*&gt;
  ): T {
    print("${prop.name} returned value $value")
    return value
  }

  operator fun setValue(
    thisRef: Any?,
    prop: KProperty&lt;*&gt;,
    newValue: T
  ) {
    print("${prop.name} changed from ${value} to ${newValue}")
    value = newValue
  }
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-kotlin">@Suppress("UNCHECKED_CAST")
  /**
   * @param key must be exist, otherwise will throw exception
   */
  class ArgExtraDelegate&lt;T&gt;(val key: String) {
    operator fun getValue(thisRef: Activity, property: KProperty&lt;*&gt;): T {
      return thisRef.intent.extras!!.get(key) as T
    }
  }

  /**
   * @param key must be exist, otherwise will throw exception
   */
  fun &lt;T&gt; argExtra(key: String) = ArgExtraDelegate&lt;T&gt;(key)

  private const val EXTRA_IS_CREATING = "isCreating"
  private val isCreating: Boolean by argExtra(EXTRA_IS_CREATING)
</pre>
</div>
</div>
</div>
<div id="outline-container-org1c67830" class="outline-4">
<h4 id="org1c67830"><span class="section-number-4">3.1.4.</span> Item 23: Avoid shadowing type parameters</h4>
</div>
<div id="outline-container-org4d5c895" class="outline-4">
<h4 id="org4d5c895"><span class="section-number-4">3.1.5.</span> Item 25: Reuse between different platforms by extracting common modules</h4>
</div>
</div>
<div id="outline-container-org04cd317" class="outline-3">
<h3 id="org04cd317"><span class="section-number-3">3.2.</span> Chapter 4: Abstraction design</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Car metaphor
</p>
</div>
<div id="outline-container-org68ddbe7" class="outline-4">
<h4 id="org68ddbe7"><span class="section-number-4">3.2.1.</span> Item 26: Each function should be written in terms of a single level of abstraction</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
Each function should be written in terms of a single level of abstraction.
</p>
</div>
</div>
<div id="outline-container-orgdf8290a" class="outline-4">
<h4 id="orgdf8290a"><span class="section-number-4">3.2.2.</span> Item 27: Use abstraction to protect code against changes</h4>
<div class="outline-text-4" id="text-3-2-2">
</div>
<div id="outline-container-orgd295203" class="outline-5">
<h5 id="orgd295203"><span class="section-number-5">3.2.2.1.</span> Abstractions give freedom</h5>
<div class="outline-text-5" id="text-3-2-2-1">
<ul class="org-ul">
<li>Extracting constant</li>
<li>Wrapping behavior into a function</li>
<li>Wrapping function into a class</li>
<li>Hiding a class behind an interface</li>
<li>Wrapping universal objects into specialistic</li>
<li>Using generic type parameters</li>
<li>Extracting inner classes</li>
<li>Restricting creation, for instance by forcing object creation via factory method</li>
</ul>
</div>
</div>
<div id="outline-container-org491f67e" class="outline-5">
<h5 id="org491f67e"><span class="section-number-5">3.2.2.2.</span> Problems with abstraction</h5>
</div>
</div>
<div id="outline-container-orgf499d12" class="outline-4">
<h4 id="orgf499d12"><span class="section-number-4">3.2.3.</span> Item 28: Specify API stability</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
Version names, documentation, and annotations.
</p>
</div>
</div>
<div id="outline-container-org82207ef" class="outline-4">
<h4 id="org82207ef"><span class="section-number-4">3.2.4.</span> Item 29: Consider wrapping external API</h4>
</div>
<div id="outline-container-orga14884b" class="outline-4">
<h4 id="orga14884b"><span class="section-number-4">3.2.5.</span> Item 30: Minimize elements visibility</h4>
</div>
<div id="outline-container-org8ff2c1b" class="outline-4">
<h4 id="org8ff2c1b"><span class="section-number-4">3.2.6.</span> Item 31: Define contract with documentation</h4>
<div class="outline-text-4" id="text-3-2-6">
<p>
When the behavior is not documented and the element name is not clear, developers will depend on current implementation instead of on the abstraction we intended to create.
</p>

<p>
When a contract is well specified, creators do not need to worry about how the class is used, and users do not need to worry about how something is implemented under the hood.
</p>
</div>
</div>
</div>
<div id="outline-container-org238da32" class="outline-3">
<h3 id="org238da32"><span class="section-number-3">3.3.</span> Chapter 5: Object creation</h3>
</div>
<div id="outline-container-orgf547a7f" class="outline-3">
<h3 id="orgf547a7f"><span class="section-number-3">3.4.</span> Chapter 6: Class design</h3>
<div class="outline-text-3" id="text-3-4">
</div>
<div id="outline-container-org12270f5" class="outline-4">
<h4 id="org12270f5"><span class="section-number-4">3.4.1.</span> Item 36: Prefer composition over inheritance</h4>
</div>
<div id="outline-container-orgf20c906" class="outline-4">
<h4 id="orgf20c906"><span class="section-number-4">3.4.2.</span> Item 37: Use the data modifier to represent a bundle of data</h4>
</div>
<div id="outline-container-org53c2924" class="outline-4">
<h4 id="org53c2924"><span class="section-number-4">3.4.3.</span> Item 38: Use function types instead of interfaces to pass operations and actions</h4>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<div class="links"><a href="#content">T</a><a href="index.html">H</a><a id="share-img">I</a><a href="20210629191000-000_index.html">0</a></div><script src="static/dom2img.min.js" type="text/javascript"></script><script src="static/x.js" type="text/javascript"></script>
</div>
</body>
</html>
